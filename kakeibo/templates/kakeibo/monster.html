<!-- three.js -->
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Noto+Serif+JP' rel="stylesheet">
    <title>three.js sample</title>
    <style>
        body { margin: 20; }
        canvas { width: 100%; height: 100% }
        .chart_container1 {
         width: 720px;
         height: 360px;
         margin: 20px 20px 0px 20px;
         margin_right: 0;
         background-color:#ffffff;

       }
       .box {
           float: left;
       }
       .boxContainer{
            overflow: hidden;
       }
       .this {
         width: 720px;
         height: 360px;
         margin: 0;
       }
    </style>



</head>
<body style="background-color:#CCFFFF">
    {% comment %}
     This part for  showing picture
     {% endcomment %}
     <div class="boxcontainer">
    <div class="box">
        <h1 font-size="60" style="font-family: 'Noto Sans JP', sans-serif;">Showing the pressure of your household account..</h1>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r120/three.min.js"></script>
        <script>
            window.addEventListener('load', init);
            var is_stopped = false;
            function init() {
                // レンダラーを作成
                const renderer = new THREE.WebGLRenderer({
                    canvas: document.querySelector('#three-canvas')
                });
                renderer.setSize( window.innerWidth / 2, window.innerHeight /2 );
                renderer.setClearColor(0x990000, 1.0);
                // saeneを作成
                const scene = new THREE.Scene();
                // cameraを作成
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 1, 1000);
                camera.position.set(0, 0, 70);
                // geometry(3Dオブジェクトの形状)を設定
                // material(オブジェクトのテクスチャ)を設定
                const textureLoader = new THREE.TextureLoader();
                var today = new Date();
                var time = today.getMinutes();
                var current_miniit = Number(time)
                var percent_current = {{percentages}}
                time = 18;
                var state = 0
                {% load static %}
                if (percent_current <= 20){
                    var newimage = "{% static 'images/Nice_Face.png' %}"
                    var otenrimage = "{% static 'images/Nice_others.png' %}"
                    var geometry = new THREE.BoxGeometry( 25, 25, 25 );
                    state = 2
                }
                else if (percent_current <= 40){
                    var newimage = "{% static 'images/Okay_Face.png' %}"
                    var otenrimage = "{% static 'images/Okay_others.png' %}"
                    var geometry = new THREE.BoxGeometry( 30, 30, 30 );
                    state = 2
                }
                else if (percent_current <= 60 ){
                    var newimage = "{% static 'images/Okay_Face.png' %}"
                    var otenrimage = "{% static 'images/Okay_others.png' %}"
                    var geometry = new THREE.BoxGeometry( 40, 40, 40 );
                    state = 3
                }
                else if (percent_current <= 80) {
                    var newimage = "{% static 'images/Screen Shot 2020-11-03 at 4.02.12.png' %}"
                    var otenrimage = "{% static 'images/Screen Shot 2020-11-03 at 4.03.05.png' %}"
                    var geometry = new THREE.BoxGeometry( 47, 47, 47);
                    state = 4
                }
                else if (percent_current <= 99 ){
                    var newimage = "{% static 'images/last.png' %}"
                    var otenrimage = "{% static 'images/last.png' %}"
                    var geometry = new THREE.BoxGeometry( 53, 53, 53 );
                    state = 5
                }
                const texture0 = textureLoader.load( newimage );
                const texture1 = textureLoader.load( newimage );
                const texture2 = textureLoader.load( newimage );
                const texture3 = textureLoader.load( newimage );
                const texture4 = textureLoader.load( otenrimage );
                const texture5 = textureLoader.load( otenrimage );
                console.log(newimage)
                const materials = [
                    new THREE.MeshBasicMaterial( { map: texture0 } ),
                    new THREE.MeshBasicMaterial( { map: texture1 } ),
                    new THREE.MeshBasicMaterial( { map: texture2 } ),
                    new THREE.MeshBasicMaterial( { map: texture3 } ),
                    new THREE.MeshBasicMaterial( { map: texture4 } ),
                    new THREE.MeshBasicMaterial( { map: texture5 } )
                ];
                const faceMaterial = new THREE.MeshFaceMaterial( materials );
                const cube = new THREE.Mesh( geometry, faceMaterial );
                scene.add(cube);


                function animate() {
                    requestAnimationFrame( animate );
                    //cubeを回転させる

                    cube.rotation.x += 0.01 * state/1;
                    cube.rotation.y += 0.01 * state/1;
                    renderer.render( scene, camera );
                };

                if (is_stopped == false){
                    animate();
                }else{
                    cube.rotation.x = 0.5;
                    cube.rotation.y = 0.5;
                    renderer.render( scene, camera );
                }
            }
            function stopanimate(){
                is_stopped = true;
                {% comment %} init().is_stopped = true {% endcomment %}
                init();
            };
            function startanimate(){
                is_stopped = false;
                init();
            };
        </script>
        <canvas id="three-canvas"></canvas>
         <button type="button" onclick="stopanimate()">stop!</button>
        <button type="button" onclick="startanimate()">start!</button>
    </div>
    <div class="box" style="margin: 160px 0px 0px 30px;">
        <a href="{% url 'kakeibo:kakeibo_list' %}" style="font-family: 'Noto Sans JP', sans-serif; font-size: 40px; color: black;">Manage your household!</a>
        <p style="font-family: 'Noto Sans JP', sans-serif; font-size: 40px; color: black; margin: 50px 0px 0px 0px; ">Setting your goal</p>

    </div>
    </div>


    {% comment %}
     This part for  showing Chart
     {% endcomment %}
     <div class="boxContainer">
        <h1 font-size="60" style="font-family: 'Noto Sans JP', sans-serif;">Weekly fee</h1>
        <div class="chart_container1 box">
            <canvas id='LineChart1' style="responsive:false height:600px; width:500px" class="this"></canvas>
        </div>
        <a class="box" href="{% url 'kakeibo:kakeibo_circle' %}" style="font-family: 'Noto Sans JP', sans-serif; font-size: 40px; color: black; margin: 60px 0px 0px 30px">See your page</a>
    <script src="https://cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

        <script>
        var ctx = document.getElementById("LineChart1").getContext('2d');
        var DiskChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels:[
            {% for item in current_week %}
                    '{{item}}',
            {% endfor %}],
            datasets: [
            {% for category_name in category_list %}
            {
            label: "{{category_name}}",　　
            fill: false,
            {% for category, color in border_color %}
                    {% if category == category_name %}
                        borderColor : "rgba({{color}})",
                    {% endif %}
            {% endfor %}
            {% for category, color in background_color %}
                    {% if category == category_name %}
                        backgroundColor : "rgba({{color}})",
                    {% endif %}
            {% endfor %}
            data:[
                    {% for d in current_week %}
                        {% for n,c,tot in matrix_list %}
                        {% if d == n and c == category_name%}
                            {{tot}},
                        {% endif %}
                        {% endfor %}
                    {% endfor %}
                    ],
            },
            {% endfor %}　
        ]
        },
        option: {
            scales: {
            yAxes: [
            {
                stacked: true,
                gridLines: {
                display: true,
                color: "rgba(255,99,132,0.2)"
                },
                ticks: {
                    suggestedMin: 0
                }
            }
            ],
            xAxes: [
            {
                gridLines: {
                display: false
                }
            }
            ]
        }
        },
        });
        </script>
    </div>
</body>
</html>
